<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, March 10, 2022, 7:58 PM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "Moku_Timers" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Moku_Timers"
   author="clafoutis"
   id="9bfdfb563323c5013a147c64"
   language="Lua"
   save_state="y"
   date_written="2022-03-10 19:56:46"
   requires="5.06"
   version="1.0"
   >

</plugin>

<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Variables  -->

<variables>
  <variable name="bgWeaponDamage">0</variable>
  <variable name="colorAlternator">0</variable>
  <variable name="fasttalkOn">0</variable>    
  <variable name="lightningOn">0</variable>  
  <variable name="myWeaponDamage">0</variable>  
  <variable name="rallyOn">0</variable>
  <variable name="snipeOn">0</variable>  
</variables>

<!--  Triggers  -->

<triggers>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Beginning Control Shell*"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Timer_Display", false)
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Exiting Control Shell\.\.\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Timer_Display", true)
	</send>
  </trigger>
  
  <!-- Timer Trigger -->

  <trigger
    enabled="y"
    keep_evaluating="y"
    match=".* looks completely puzzled and does not seem to be concentrating at the moment\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Fasttalk_Timer", true)
	  ResetTimer("Fasttalk_Timer")
  	  SetVariable("fasttalkOn", 1)
	</send>
  </trigger> 

   <trigger
    enabled="y"
    keep_evaluating="y"
    match="You carefully override all"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Rapid_Timer", true)
	  ResetTimer("Rapid_Timer")
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match=".* staggers and falls to the ground\.\.\. dead\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Fasttalk_Timer", false)
  	  SetVariable("fasttalkOn", 0)
	</send>
  </trigger> 

  <trigger
    enabled="y"
    keep_evaluating="y"
    match=".* takes a calculated swing at .* head"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Disable_Timer", true)
	  ResetTimer("Disable_Timer")
	</send>
  </trigger> 
 
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Lightning arcs from your fingers to .*\!"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Lightning_Timer", true)
	  ResetTimer("Lightning_Timer")
	  SetVariable("lightningOn", 1)
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="That weapon isn't damaged\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("myWeaponDamage", 0)
	</send>
  </trigger>  
  
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="The last arcs of lightning fade from .* skin\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Lightning_Timer", false)
	  SetVariable("lightningOn", 0)
	</send>
  </trigger>  

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You apply the salve and release toxins from your body\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Salve_Timer", true)
	  ResetTimer("Salve_Timer")
	</send>
  </trigger>
 
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You concentrate your will on projecting an aura of uneasiness around yourself\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Aura_Timer", true)
	  ResetTimer("Aura_Timer")
	</send>
  </trigger>

 <trigger
    enabled="y"
    keep_evaluating="y"
    match="You jam medical supplies into your deepest wounds\, just like you learned back in basic\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("FieldDressing_Timer", true)
	  ResetTimer("FieldDressing_Timer")
	</send>
  </trigger>

 <trigger
    enabled="y"
    keep_evaluating="y"
    match="You perform cureall surgery on yourself\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Cureall_Timer", true)
	  ResetTimer("Cureall_Timer")
	</send>
  </trigger>

   <trigger
    enabled="y"
    keep_evaluating="y"
    match="You push yourself beyond your normal limits in order to move a little faster\!"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Haste_Timer", true)
	  ResetTimer("Haste_Timer")
	</send>
  </trigger>

   <trigger
    enabled="y"
    keep_evaluating="y"
    match="Your quick reflexes gain you a momentary advantage over .*\!"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Fastdraw_Timer", true)
	  ResetTimer("Fastdraw_Timer")
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You say: Let's kick some butt\!"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Rally_Timer", true)
	  ResetTimer("Rally_Timer")
	  SetVariable("rallyOn", 1)
	</send>
  </trigger>

 <trigger
    enabled="y"
    keep_evaluating="y"
    match="You settle down into a prone position\, slow your breathing, and carefully take aim at .*\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Snipe_Timer", true)
	  ResetTimer("Snipe_Timer")
  	  SetVariable("snipeOn", 1)	  
	</send>
  </trigger>
  
   <trigger
    enabled="y"
    keep_evaluating="y"
    match="Your wounds heal over as the drug runs through your body\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Retro_Timer", true)
	  ResetTimer("Retro_Timer")
	</send>
  </trigger>

  <!-- Warning Triggers -->

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You notice the wear on your weapon\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("myWeaponDamage", 1)
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You notice the wear on Mokuren's Bodyguard's weapon\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("bgWeaponDamage", 1)
	</send>
  </trigger>
  
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You repair your .*$"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("myWeaponDamage", 0)
	</send>
  </trigger>
  
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Mokuren's Bodyguard repairs (his|her) .*$"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("bgWeaponDamage", 0)
	</send>
  </trigger>

</triggers>

<!--  Aliases  -->

<aliases>

  <alias
    enabled="y"
    match="reset bg weapon"
    regexp="y"
    send_to="12"
    sequence="100"
    >
	<send>
      SetVariable ("bgWeaponDamage", 0)	
	</send>
  </alias>

  <alias
    enabled="y"
    match="reset weapon"
    regexp="y"
    send_to="12"
    sequence="100"
    >
	<send>
      SetVariable ("myWeaponDamage", 0)	
	</send>
  </alias>

</aliases>

<!-- timers -->

<timers>

  <timer
    name="Aura_Timer" 
    enabled="n"
    minute="5"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Aura_Timer", false)
    </send>
  </timer>

  <timer
    name="Cureall_Timer" 
    enabled="n"
    minute="10"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Cureall_Timer", false)
    </send>
  </timer>

  <timer
    name="Disable_Timer" 
    enabled="n"
    minute="3"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Disable_Timer", false)
    </send>
  </timer>

  <!-- drawing salve -->
  <timer
    name="Salve_Timer" 
    enabled="n"
    minute="10"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Salve_Timer", false)
    </send>
  </timer>

  <timer
    name="Fastdraw_Timer" 
    enabled="n"
    minute="0"
    second="30.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Fastdraw_Timer", false)
    </send>
  </timer>

  <timer
    name="Fasttalk_Timer"
    enabled="n"
    minute="3"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Fasttalk_Timer", false)
	  SetVariable("fasttalkOn", 0)
    </send>
  </timer>

  <timer
    name="FieldDressing_Timer" 
    enabled="n"
    minute="5"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("FieldDressing_Timer", false)
    </send>
  </timer>

  <timer
    name="Haste_Timer" 
    enabled="n"
    minute="3"
    second="0"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Haste_Timer", false)
    </send>
  </timer>
  
  <timer
    name="Lightning_Timer"
    enabled="n"
    minute="0"
    second="30.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Lightning_Timer", false)
	  SetVariable("lightningOn", 0)
    </send>
  </timer>

  <timer
    name="Rally_Timer"
    enabled="n"
    minute="2"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Rally_Timer", false)
	  SetVariable("rallyOn", 0)
    </send>
  </timer>

  <timer
    name="Rapid_Timer" 
    enabled="n"
    minute="1"
    second="0"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Rapid_Timer", false)
    </send>
  </timer>

  <timer
    name="Retro_Timer" 
    enabled="n"
    minute="10"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Retro_Timer", false)
    </send>
  </timer>

  <timer
    name="Snipe_Timer" 
    enabled="n"
    minute="0"
    second="30.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Snipe_Timer", false)
	  SetVariable("snipeOn", 0)	  
    </send>
  </timer>

  <timer
    name="Timer_Display"
    enabled="y"
    second="1.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
	  
      DisplayTitle ()
	  DisplayDelay ("Aura_Timer", 'aura of uneasiness')
	  DisplayDelay ("Cureall_Timer", 'cureall surgery or nanoheal')
	  DisplayDelay ("Salve_Timer", 'drawing salve')
	  DisplayDelay ("Disable_Timer", 'enemy\'s disable')	  
	  DisplayDelay ("Fasttalk_Timer", 'fasttalk')
	  DisplayDelay ("Fastdraw_Timer", 'fastdraw')
	  DisplayDelay ("FieldDressing_Timer", 'field dressing')
	  DisplayDelay ("Haste_Timer", 'haste')	  
	  DisplayDelay ("Rally_Timer", 'rally')
	  DisplayDelay ("Rapid_Timer", 'rapid fire')	  
	  DisplayDelay ("Retro_Timer", 'retrovirus or silver poison')	  
	  DisplayDelay ("Snipe_Timer", 'sniping')	  
	  
      t:Note("")	  
	  
	  myWeaponStatus ()
	  bgWeaponStatus () 
    </send>
  </timer>

</timers>

<!--  Script  -->

<script>

  <![CDATA[

    function OnPluginInstall (s)

      SetVariable("bgWeaponDamage", 0)
      SetVariable("colorAlternator", 0)
      SetVariable("fasttalkOn", 0)	  
      SetVariable("lightningOn", 0)
      SetVariable("myWeaponDamage", 0)
	  SetVariable("rallyOn", 0)

      local openedTargetterOk = world.Open ("worlds\\\\Space_Targetter.MCL")
      local SWmudOpened = world.Open ("worlds\\\\SWmud.MCL") -- puts focus back on main window
	  
      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" world	  
	  
      if openedTargetterOk == true then
        t:DeleteOutput()
        t:Note ('Moku_Timers Plugin installed')
      else
	    Note ("Moku_Timers Did Not Load")
	  end	  

    end -- function OnPluginInstall

    function DisplayTitle ()
      	
      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" world
	    
      t:DeleteOutput ()
      t:ColourNote (
        "#35A5CE", "black", "                Timers:")
      t:ColourNote ("green", "black", "---------------------------------------")	

      SetVariable("colorAlternator", 0)	 

    end -- function DisplayTitle
	
	function myWeaponStatus ()

      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
      local myWeaponDamage = tonumber(GetVariable("myWeaponDamage"))

      if myWeaponDamage == 1 then
        t:ColourNote(
          "yellow", "black", "Your weapon is damaged                               <reset weapon>")
	  end
	  
    end -- function myWeaponStatus
	
	function bgWeaponStatus ()

      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
      local bgWeaponDamage = tonumber(GetVariable("bgWeaponDamage"))

      if bgWeaponDamage == 1 then
        t:ColourNote(
          "yellow", "black", "Your bodyguard's weapon is damaged                <reset bg weapon>")
	  end
	  
    end -- function bgWeaponStatus

    function DisplayDelay (timerName, delayName)
	
      local secRemain = GetTimerInfo (timerName, 13)
      local timerOn = GetTimerInfo (timerName, 6)
      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
      local colorAlternator = tonumber(GetVariable("colorAlternator"))

      if timerOn == true then
        secRemain = math.floor(secRemain + 0.5)
        local min = math.floor(secRemain / 60)
        local sec = secRemain - (min * 60)

        if sec < 10 then
          sec = "0" .. sec
        end

        if min < 10 then
          min = " " .. min
        end
		
        if colorAlternator == 0 then
          t:ColourNote(
            "gray", "black", delayName .. ": ",
            "cornflowerblue", "black", min,
            "cornflowerblue", "black", ":",
            "cornflowerblue", "black", sec)
		  SetVariable("colorAlternator", 1)  
	    else
          t:ColourNote(
            "#C0C0C0", "black", delayName .. ": ",
            "cyan", "black", min,
            "cyan", "black", ":",
            "cyan", "black", sec)
		  SetVariable("colorAlternator", 0)  
        end	
		  
	  end
	
	end -- DisplayDelay
	
  ]]>

</script>

</muclient>
