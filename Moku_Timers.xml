<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Thursday, March 10, 2022, 7:58 PM -->
<!-- MuClient version 5.06 -->

<!-- Plugin "Moku_Timers" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Moku_Timers"
   author="clafoutis"
   id="9bfdfb563323c5013a147c64"
   language="Lua"
   save_state="y"
   date_written="2022-03-10 19:56:46"
   requires="5.06"
   version="1.0"
   >

</plugin>

<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Variables  -->

<variables>
  <variable name="lightningOn">0</variable>  
  <variable name="lightningOn">0</variable>  
  <variable name="rallyOn">0</variable>
</variables>

<!--  Triggers  -->

<triggers>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Beginning Control Shell*"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Timer_Display", false)
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Exiting Control Shell\.\.\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Timer_Display", true)
	</send>
  </trigger>
  
  <!-- Timer Trigger -->
  
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="Lightning arcs from your fingers to .*\!"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Lightning_Timer", true)
	  ResetTimer("Lightning_Timer")
	  SetVariable("lightningOn", 1)
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="That weapon isn't damaged\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("myWeaponDamage", 0)
	</send>
  </trigger>  
  
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="The last arcs of lightning fade from .* skin\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Lightning_Timer", false)
	  SetVariable("lightningOn", 0)
	</send>
  </trigger>  

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You apply the salve and release toxins from your body\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Salve_Timer", true)
	  ResetTimer("Salve_Timer")
	</send>
  </trigger>

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You say: Let's kick some butt\!"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
	  EnableTimer ("Rally_Timer", true)
	  ResetTimer("Rally_Timer")
	  SetVariable("rallyOn", 1)
	</send>
  </trigger>

  <!-- Warning Trigger -->

  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You notice the wear on your weapon\."
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("myWeaponDamage", 1)
	</send>
  </trigger>
  
  <trigger
    enabled="y"
    keep_evaluating="y"
    match="You repair your .*$"
    regexp="y"
    send_to="12"
    sequence="100"
  >
    <send>
      SetVariable ("myWeaponDamage", 0)
	</send>
  </trigger>

</triggers>

<!--  Aliases  -->

<aliases>

  <alias
    enabled="y"
    match="reset weapon"
    regexp="y"
    send_to="12"
    sequence="100"
    >
	<send>
      SetVariable ("myWeaponDamage", 0)	
	</send>
  </alias>

</aliases>

<!-- timers -->

<timers>

  <!-- drawing salve -->
  <timer
    name="Salve_Timer" 
    enabled="n"
    minute="10"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Salve_Timer", false)
    </send>
  </timer>

  <timer
    name="Lightning_Timer"
    enabled="n"
    minute="0"
    second="30.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Lightning_Timer", false)
	  SetVariable("lightningOn", 0)
    </send>
  </timer>

  <timer
    name="Rally_Timer"
    enabled="n"
    minute="2"
    second="0.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  EnableTimer ("Rally_Timer", false)
	  SetVariable("rallyOn", 0)
    </send>
  </timer>

  <timer
    name="Timer_Display"
    enabled="y"
    second="1.00"
    offset_second="0.00"
    send_to="12"
  >
    <send>
	  local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
	  
      DisplayTitle ()
	  DrawingSalveTimer ()
	  RallyTimer ()
	  
      t:Note("")	  
	  
	  myWeaponStaus ()
    </send>
  </timer>

</timers>

<!--  Script  -->

<script>

  <![CDATA[

    function OnPluginInstall (s)

      SetVariable("lightningOn", 0)
      SetVariable("myWeaponDamage", 0)
	  SetVariable("rallyOn", 0)

      local openedTargetterOk = world.Open ("worlds\\\\Space_Targetter.MCL")
      local SWmudOpened = world.Open ("worlds\\\\SWmud.MCL") -- puts focus back on main window
	  
      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" world	  
	  
      if openedTargetterOk == true then
        t:DeleteOutput()
        t:Note ('Moku_Timers Plugin installed')
      else
	    Note ("Moku_Timers Did Not Load")
	  end	  

    end -- function OnPluginInstall

    function DisplayTitle ()
      	
      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" world
	    
      t:DeleteOutput ()
      t:ColourNote (
        "#35A5CE", "black", "                Timers:")
      t:ColourNote ("green", "black", "---------------------------------------")	
      t:ColourNote (
	    "gray", "black", "Colors for alternator ",
        "#C0C0C0", "black", "Alt 1 ",
        "cyan", "black", "Alt 2") 

    end -- function DisplayTitle
	
	function DrawingSalveTimer ()

      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
	  
        local secRemain = GetTimerInfo ("Salve_Timer", 13)
		local timerOn = GetTimerInfo ("Salve_Timer", 6)

        if timerOn == true then
          secRemain = math.floor(secRemain + 0.5)
          local min = math.floor(secRemain / 60)
          local sec = secRemain - (min * 60)

          if sec < 10 then
            sec = "0" .. sec
          end

          if min < 10 then
            min = " " .. min
          end

          t:ColourNote(
            "gray", "black", "drawing salve: ",
            "cornflowerblue", "black", min,
            "cornflowerblue", "black", ":",
            "cornflowerblue", "black", sec)
		end
	  
    end -- function RallyTimer
	
		function RallyTimer ()

      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
	  
        local secRemain = GetTimerInfo ("Rally_Timer", 13)
		local timerOn = GetTimerInfo ("Rally_Timer", 6)

        if timerOn == true then
          secRemain = math.floor(secRemain + 0.5)
          local min = math.floor(secRemain / 60)
          local sec = secRemain - (min * 60)

          if sec < 10 then
            sec = "0" .. sec
          end

          if min < 10 then
            min = " " .. min
          end

          t:ColourNote(
            "gray", "black", "rally: ",
            "cornflowerblue", "black", min,
            "cornflowerblue", "black", ":",
            "cornflowerblue", "black", sec)
		end
	  
    end -- function RallyTimer
	

	function myWeaponStaus ()

      local t = GetWorld ("Space_Targetter")  -- get "Space_Targetter" worlds\\\\SWmud
      local myWeaponDamage = tonumber(GetVariable("myWeaponDamage"))

      if myWeaponDamage == 1 then
        t:ColourNote(
          "yellow", "black", "Your weapon is damaged                               <reset weapon>")
	  end
	  
    end -- function myWeaponStaus
		
  ]]>

</script>

</muclient>
